(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["subPackages/animal/animalEdit/newEdit"],{"03ea":function(t,e,a){"use strict";a.r(e);var s=a("1ee2"),r=a("0cda");for(var i in r)"default"!==i&&function(t){a.d(e,t,(function(){return r[t]}))}(i);a("81e8");var o,n=a("f0c5"),c=Object(n["a"])(r["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],o);e["default"]=c.exports},"0cda":function(t,e,a){"use strict";a.r(e);var s=a("cb43"),r=a.n(s);for(var i in s)"default"!==i&&function(t){a.d(e,t,(function(){return s[t]}))}(i);e["default"]=r.a},"1ee2":function(t,e,a){"use strict";a.d(e,"b",(function(){return r})),a.d(e,"c",(function(){return i})),a.d(e,"a",(function(){return s}));var s={uniForms:function(){return Promise.all([a.e("common/vendor"),a.e("components/uni-forms/uni-forms")]).then(a.bind(null,"356a"))},uniFormsItem:function(){return a.e("components/uni-forms-item/uni-forms-item").then(a.bind(null,"d228"))}},r=function(){var t=this,e=t.$createElement,a=(t._self._c,t.ageList.indexOf(t.formData.age)),s=t.__map(t.experienceList,(function(e,a){var s=t.__get_orig(e),r=t.curSterList.includes(e.name);return{$orig:s,g1:r}})),r=t.__map(t.experienceList,(function(e,a){var s=t.__get_orig(e),r=t.curHelminList.includes(e.name);return{$orig:s,g2:r}})),i=t.__map(t.experienceVaccineList,(function(e,a){var s=t.__get_orig(e),r=t.curVacciList.includes(e.name);return{$orig:s,g3:r}})),o=t.__map(t.bodyTypeList,(function(e,a){var s=t.__get_orig(e),r=t.curBodyTypeList.includes(e.name);return{$orig:s,g4:r}})),n=t.__map(t.featherList,(function(e,a){var s=t.__get_orig(e),r=t.curFeatherList.includes(e.name);return{$orig:s,g5:r}})),c=t.__map(t.characterList,(function(e,a){var s=t.__get_orig(e),r=t.curCharacterList.includes(e.name);return{$orig:s,g6:r}}));t.$mp.data=Object.assign({},{$root:{g0:a,l0:s,l1:r,l2:i,l3:o,l4:n,l5:c}})},i=[]},"46d7":function(t,e,a){"use strict";(function(t){a("a09d");s(a("66fd"));var e=s(a("03ea"));function s(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=a,t(e.default)}).call(this,a("543d")["createPage"])},"81e8":function(t,e,a){"use strict";var s=a("ff46"),r=a.n(s);r.a},cb43:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;o(a("ac30"));var s=o(a("4672")),r=a("26cb"),i=a("8d4b");function o(t){return t&&t.__esModule?t:{default:t}}function n(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,s)}return a}function c(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?n(Object(a),!0).forEach((function(e){u(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function u(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var h=a("c1aa"),l=a("2e3e"),f={data:function(){return{rules:{headImageId:{rules:[{required:!0,format:"text",errorMessage:"请上传动物头像！"}]},name:{rules:[{required:!0,format:"text",maxLength:16,errorMessage:"请填写动物名称，小于{maxLength}个字符！"}]},sex:{rules:[{required:!0,format:"integer"}]},type:{rules:[{required:!0,format:"integer"}]},during:{rules:[{required:!0,format:"text"}]},sterList:{rules:[{required:!0,format:"text"}]},helminList:{rules:[{required:!0,format:"text"}]},vacciList:{rules:[{required:!0,format:"text"}]},bodyList:{rules:[{format:"text"}]},featherList:{rules:[{format:"text"}]},characterList:{rules:[{format:"text"}]},intro:{rules:[{maxLength:1024,errorMessage:"地址长度需要小于{maxLength}个字符"}]}},animalId:"",baseId:"",defaultImage:"../../static/images/default_avator.png",imageList:[],imageIds:[],formData:{age:"1岁",baseId:"",characterDesc:"",headImageId:"",healthStatus:"",id:"",identityCode:"",intro:"",isAdopted:0,name:"",sameOrigin:!0,sex:0,shapeDesc:"",succorStatus:"流浪",succorTime:i.getDate,type:0,isDelete:!1,isEdit:!1,petId:""},curSterList:[],curHelminList:[],curVacciList:[],curBodyTypeList:[],curFeatherList:[],curCharacterList:[],formItemPlaceHolder:{name:"昵称",intro:"简介",age:"年龄",sex:"性别",identityCode:"身份号",healthStatus:"常规医疗",succorTime:"来基地日期",succorStatus:"时期",shapeDesc:"外形",characterDesc:"性格",sameOrigin:"只限本地领养",type:"动物种类",isAdopted:"等待领养"},uploadFileUrl:l.baseUrl,index:0,startDate:(0,i.getDate)("startDate"),endDate:(0,i.getDate)("endDate")}},computed:c(c({},(0,r.mapState)({sexList:function(t){return t.tags.sexList},typeList:function(t){return t.tags.typeList},ageList:function(t){return t.tags.ageList},experienceVaccineList:function(t){return t.tags.experienceVaccineList},experienceList:function(t){return t.tags.experienceList},duringList:function(t){return t.tags.duringList},bodyTypeList:function(t){return t.tags.bodyTypeList},featherList:function(t){return t.tags.featherList},adoptList:function(t){return t.tags.adoptList},limitSameCityList:function(t){return t.tags.limitSameCityList},characterList:function(t){return t.tags.characterList}})),{},{headImageId:function(){if(this.formData.headImageId)return this.formData.headImageId}}),onReady:function(){this.$refs.formData.setRules(this.rules)},methods:{initData:function(){var t=this;console.log("获取动物信息"),(0,i.isEmpty)(this.animalId)?(this.getCurTagList("没有",1),this.getCurTagList("没有",2),this.getCurTagList("未接种",3)):h.getAnimalHomeInfo({animalId:this.animalId}).then((function(e){console.log(e),t.imageIds=e.result.imageIds,t.imageIds.forEach((function(e){t.imageList.push(e)})),t.formData=e.result,t.formData.id=t.animalId,t.formData.identityCode=e.result.identityCode,t.formData.petId=e.result.petId,t.formData.sameOrigin=e.result.sameOrigin,t.formData.isAdopted=e.result.isAdopted,t.formData.characterDesc=e.result.characterDesc,t.formData.healthStatus=e.result.healthStatus,t.formData.shapeDesc=e.result.shapeDesc,t.formData.succorStatus=e.result.succorStatus,t.formData.intro=e.result.intro,t.getCurTagList(t.formData.healthStatus,1),t.getCurTagList(t.formData.healthStatus,2),t.getCurTagList(t.formData.healthStatus,3),t.getCurTagList(t.formData.shapeDesc,4),t.getCurTagList(t.formData.shapeDesc,5),t.getCurTagList(t.formData.characterDesc,6)}))},removeImage:function(t){this.imageList.splice(t,1),this.imageIds.splice(t,1)},bindDateChange:function(t){this.formData.succorTime=t.target.value},onKeyInputNickName:function(t){this.formData.name=t.target.value},onKeyInputIntro:function(t){this.formData.intro=t.target.value},onClick:function(e){this.formData.isEdit=!0,this.formData.editItem={placeholder:this.formItemPlaceHolder[e],key:e,type:this.getInputType(e)},console.log(this.formData,e),t.navigateTo({url:"./editFormItem"})},getInputType:function(t){return["age"].includes(t)?"number":["identityCode"].includes(t)?"camera":["succorTime"].includes(t)?"date":["characterDesc","healthStatus","shapeDesc","succorStatus"].includes(t)?"tags":["intro"].includes(t)?"textarea":["isAdopted","sameOrigin","sex","type"].includes(t)?"picker":"input"},getCurTagList:function(t,e){if(console.log("enter getCurTagList curSaveList!",t),4!==e&&5!==e&&6!==e||!(0,i.isEmpty)(t)){console.log("enter getCurTagList curList next!");var a,s=t.split("/");switch(console.log("enter getCurTagList curList:",s),e){case 1:for(a in s)if("绝育"===s[a]){console.log("case 1 已经！"),this.curSterList.push("已经");break}this.curSterList.length<1&&(console.log("case 1 没有！"),this.curSterList.push("没有"));break;case 2:for(a in s)if("驱虫"===s[a]){console.log("case 2 已经！"),this.curHelminList.push("已经");break}this.curHelminList.length<1&&(console.log("case 2 没有！"),this.curHelminList.push("没有"));break;case 3:for(a in s){if("疫苗"===s[a]){console.log("case 3 已接种！"),this.curVacciList.push("已接种");break}if("疫苗中"===s[a]){console.log("case 3 接种中！"),this.curVacciList.push("接种中");break}}this.curVacciList.length<1&&(console.log("case 3 未接种！"),this.curVacciList.push("未接种"));break;case 4:for(a in s)for(r in this.bodyTypeList)this.bodyTypeList[r].name.search(s[a])>-1&&(console.log("case 4 tag,index:",s[a],this.bodyTypeList[r].name),this.curBodyTypeList.push(this.bodyTypeList[r].name));break;case 5:for(a in s)for(r in this.featherList)this.featherList[r].name.search(s[a])>-1&&(console.log("case 5 tag,index:",s[a],this.featherList[r].name),this.curFeatherList.push(this.featherList[r].name));break;case 6:var r;for(a in s)for(r in this.characterList)this.characterList[r].name.search(s[a])>-1&&(console.log("case 6 tag,index:",s[a],this.characterList[r].name),this.curCharacterList.push(this.characterList[r].name));break}}},set6Chara2formData3Chara:function(){var t;for(t in this.formData.characterDesc="",this.formData.healthStatus="",this.formData.shapeDesc="",this.curCharacterList)this.formData.characterDesc.length>0&&(this.formData.characterDesc+="/"),this.formData.characterDesc+=this.curCharacterList[t];for(t in this.curBodyTypeList)this.formData.shapeDesc.length>0&&(this.formData.shapeDesc+="/"),this.formData.shapeDesc+=this.curBodyTypeList[t];for(t in this.curFeatherList)this.formData.shapeDesc.length>0&&(this.formData.shapeDesc+="/"),this.formData.shapeDesc+=this.curFeatherList[t];for(t in this.curSterList)this.curSterList[t].search("已经")>-1&&(this.formData.healthStatus.length>0&&(this.formData.healthStatus+="/"),this.formData.healthStatus+="绝育");for(t in this.curHelminList)this.curHelminList[t].search("已经")>-1&&(this.formData.healthStatus.length>0&&(this.formData.healthStatus+="/"),this.formData.healthStatus+="驱虫");for(t in this.curVacciList)this.curVacciList[t].search("已接种")>-1?(this.formData.healthStatus.length>0&&(this.formData.healthStatus+="/"),this.formData.healthStatus+="疫苗"):this.curVacciList[t].search("接种中")>-1&&(this.formData.healthStatus.length>0&&(this.formData.healthStatus+="/"),this.formData.healthStatus+="疫苗中")},switch1Change:function(t){console.log("switch1 领养状态从等待领养到不需要领养",t.target.value),this.formData.isAdopted=3},switch2Change:function(t){console.log("switch2 领养状态从不需要领养到等待领养",t.target.value),this.formData.isAdopted=0},switch3Change:function(t){console.log("switch3 同城限制从限制到不限制",t.target.value),this.formData.sameOrigin=!1},switch4Change:function(t){console.log("switch4 同城限制从不限制到限制",t.target.value),this.formData.sameOrigin=!0},choose:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(1===a)this.formData[e]=t.value;else if(2===a)this.formData[e]=t.name;else if(3===a)if("curCharacterList"===e)if(this.curCharacterList.includes(t.name)){console.log("curCharacterList length index: ",this.curCharacterList.length,this.curCharacterList.indexOf(t.name));var s=this.curCharacterList.indexOf(t.name);delete this.curCharacterList[s],this.curCharacterList.sort(),this.curCharacterList.pop(),console.log("curCharacterList length index: ",this.curCharacterList.length)}else this.curCharacterList.push(t.name);else{var r;switch(console.log("key.length:",e),e){case"curSterList":r=this.curSterList;break;case"curHelminList":r=this.curHelminList;break;case"curVacciList":r=this.curVacciList;break;case"curFeatherList":r=this.curFeatherList;break;case"curBodyTypeList":r=this.curBodyTypeList;break}r.length>0?(r.push(t.name),r.shift()):r.push(t.name)}},formReset:function(t){console.log("清空数据")},change:function(t,e){console.log("change改变数据！"),this.formData.checked=e,this.$refs.formData.setValue(t,e)},bindPickerChange:function(t){console.log("picker发送选择改变，携带值为",t.target.value),this.formData.age=this.ageList[t.target.value]},submitForm:function(e){var a=this;this.$refs[e].validate().then((function(e){console.log("表单的值：",e),a.set6Chara2formData3Chara(),h.postAnimalBasicInfo({animal:a.formData,imageIds:a.imageIds}).then((function(e){var s="新增成功";a.formData.id&&(s="修改成功"),t.showToast({duration:2e3,title:s}),console.log("postAnimalBasicInfo result",e),setTimeout((function(){try{var e=getCurrentPages(),a=e[e.length-2];a.$vm.initData()}catch(s){console.log(s)}t.navigateBack({delta:1})}),2e3)}))})).catch((function(t){console.error("验证失败：",t)}))},chooseImage:function(){var e=this;t.chooseImage({count:9,sizeType:["original","compressed"],sourceType:["album"],success:function(a){console.log("enter chooseImage sucess:",a),a.tempFiles.forEach((function(a){var r=a.size;if(r>10485760)t.showToast({title:"上传的图片大小不超过10M",icon:"none",duration:2e3,mask:!0});else if((0,i.chooseImageFormat)(a.path)){e.imageList.push(a.path);var o=e.uploadFileUrl+"/upload/animal/image";t.uploadFile({url:o,filePath:a.path,header:{"Access-Token":e.$store.state.user.token},name:"image",success:function(t){if(console.log(t),200===t.statusCode){var a=JSON.parse(t.data);e.imageIds.push(s.default.baseImageUrl+a.result)}else console.log("uploadFileRes fail statuCode:",t.statusCode)}})}else console.log("wrong picture path",a.path)}))}})},chooseAvator:function(){var e=this;t.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album"],success:function(a){console.log("enter chooseAvator res:",a),a.tempFiles.forEach((function(a){var r=a.size;if(r>10485760)t.showToast({title:"上传的图片大小不超过10M",icon:"none",duration:2e3,mask:!0});else if((0,i.chooseImageFormat)(a.path)){e.userImage=a.path;var o=e.uploadFileUrl+"/upload/animal/image";console.log("enter chooseAvatar tempath,currentUrl,appConfig.baseImageUrl:",e.userImage,o,s.default.baseImageUrl),t.uploadFile({url:o,filePath:a.path,header:{"Access-Token":e.$store.state.user.token},name:"image",success:function(t){if(console.log("chooseAvator uploadFile success:",t),200===t.statusCode){var a=JSON.parse(t.data);e.formData.headImageId=s.default.baseImageUrl+a.result}else console.log("uploadFileRes fail statuCode:",t.statusCode)}})}else console.log("wrong picture path",a.path)}))}})}},onShow:function(){var e=this;console.log("show"),this.formData.isEdit&&t.getStorage({key:"animalData",success:function(t){console.log("edit",t.data),e.formData=t.data}})},onHide:function(){console.log("hide"),t.setStorage({key:"animalData",data:this.formData})},onLoad:function(t){console.log(t,"adopt-options"),t.animalId&&(this.formData.id=t.animalId,this.animalId=t.animalId),t.baseId&&(this.formData.baseId=t.baseId),t.userId&&(this.formData.userId=t.userId),this.initData()}};e.default=f}).call(this,a("543d")["default"])},ff46:function(t,e,a){}},[["46d7","common/runtime","common/vendor"]]]);