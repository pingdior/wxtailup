(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/editForm"],{"09dc":function(e,t,o){"use strict";o.d(t,"b",(function(){return n})),o.d(t,"c",(function(){return r})),o.d(t,"a",(function(){return a}));var a={uniList:function(){return o.e("components/uni-list/uni-list").then(o.bind(null,"bc51"))},uniListItem:function(){return o.e("components/uni-list-item/uni-list-item").then(o.bind(null,"d4b5"))}},n=function(){var e=this,t=e.$createElement;e._self._c},r=[]},1455:function(e,t,o){},"1ff4":function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(o("ac30")),n=i(o("4672")),r=o("26cb"),s=o("8d4b");function i(e){return e&&e.__esModule?e:{default:e}}function u(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function c(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?u(Object(o),!0).forEach((function(t){l(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):u(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var f=o("2e3e"),m={components:{},data:function(){return{defaultImage:"/static/images/default_avator.png",userImage:"",imageList:[],formData:{imageIds:[],avator:"",name:"",sex:"",wxNumber:"",phone:"",isEdit:!1},formItemPlaceHolder:{name:"昵称",phone:"手机号"},uploadUrl:f.baseUrl}},computed:c({},(0,r.mapState)({appUserInfo:function(e){return e.user.userInfo}})),methods:{onClick:function(t){e.navigateTo({url:"/pages/user/editFormItem"}),this.formData.isEdit=!0,this.formData.editItem={placeholder:this.formItemPlaceHolder[t],key:t,type:["description"].includes(t)?"textarea":"text"},console.log(this.formData,t),e.navigateTo({url:"./editFormItem"})},getUserInfo:function(){var e=this;a.default.getUserInfo().then((function(t){for(var o in console.log("用户信息",t),e.formData)e.formData[o]=t.result[o];console.log("enter getUserInfo formData|appUserInfo:",e.formData,e.appUserInfo),e.formData.name||(e.formData.name=e.appUserInfo.nickName),e.userImage||(e.userImage=e.appUserInfo.headImgUrl),e.formData.imageIds.length&&(e.imageList=[],e.formData.imageIds.forEach((function(t){e.imageList.push(t)}))),console.log(e.imageList)}))},removeImage:function(e){this.imageList.splice(e,1),this.formData.imageIds.splice(e,1)},chooseImage:function(){var t=this;e.chooseImage({count:9,sizeType:["original","compressed"],sourceType:["album"],success:function(o){console.log(o),o.tempFiles.forEach((function(o){var a=o.size;if(a>10485760)e.showToast({title:"上传的图片大小不超过10M",icon:"none",duration:2e3,mask:!0});else if((0,s.chooseImageFormat)(o.path)){t.imageList.push(o.path);var r=t.uploadUrl+"/upload/user/image";console.log("current url:",r),e.uploadFile({url:r,filePath:o.path,header:{"Access-Token":t.$store.state.user.token},name:"image",success:function(e){console.log(e);var o=JSON.parse(e.data);t.formData.imageIds.push(n.default.baseImageUrl+o.result)}})}else console.log("wrong picture path",o.path)}))}})},chooseAvator:function(){var t=this;e.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album"],success:function(o){console.log(o),o.tempFiles.forEach((function(o){var a=o.size;if(a>10485760)e.showToast({title:"上传的图片大小不超过10M",icon:"none",duration:2e3,mask:!0});else{var r=o.path.slice(-3).toLowerCase(),s=["bmp","png","jpg"];if(s.includes(r)){t.userImage=o.path;var i=t.uploadUrl+"/upload/user/image";console.log("current url:",i),e.uploadFile({url:i,filePath:o.path,header:{"Access-Token":t.$store.state.user.token},name:"image",success:function(e){console.log(e);var o=JSON.parse(e.data);t.formData.headImageId=n.default.baseImageUrl+o.result}})}else e.showToast({title:"图片必须是bmp, png或jpg类型",icon:"none",duration:2e3,mask:!0})}}))}})},onConfirm:function(){console.log("完成",this.formData),a.default.updateUserBasicInfo({imageIds:this.formData.imageIds,phone:this.formData.phone,wxNumber:this.formData.wxNumber}).then((function(t){console.log("更新信息",t),e.showToast({title:"更新成功",duration:2e3});try{var o=getCurrentPages(),a=o[o.length-2];a.$vm.$refs.userRef.getUserInfo()}catch(n){console.log(n)}setTimeout((function(){e.navigateBack({delta:1})}),2e3)}))}},mounted:function(){this.getUserInfo()},onShow:function(){var t=this;console.log("show"),this.formData.isEdit&&e.getStorage({key:"userFormData",success:function(e){console.log("edit",e.data),t.formData=e.data}})},onHide:function(){console.log("hide"),e.setStorage({key:"userFormData",data:this.formData})},onLoad:function(){console.log("load")},onUnload:function(){console.log("unload"),e.removeStorage({key:"userFormData"})}};t.default=m}).call(this,o("543d")["default"])},"7a90":function(e,t,o){"use strict";(function(e){o("a09d");a(o("66fd"));var t=a(o("a180"));function a(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=o,e(t.default)}).call(this,o("543d")["createPage"])},8466:function(e,t,o){"use strict";var a=o("1455"),n=o.n(a);n.a},"9a10":function(e,t,o){"use strict";o.r(t);var a=o("1ff4"),n=o.n(a);for(var r in a)"default"!==r&&function(e){o.d(t,e,(function(){return a[e]}))}(r);t["default"]=n.a},a180:function(e,t,o){"use strict";o.r(t);var a=o("09dc"),n=o("9a10");for(var r in n)"default"!==r&&function(e){o.d(t,e,(function(){return n[e]}))}(r);o("8466");var s,i=o("f0c5"),u=Object(i["a"])(n["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],s);t["default"]=u.exports}},[["7a90","common/runtime","common/vendor"]]]);